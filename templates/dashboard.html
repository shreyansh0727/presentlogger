<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Attendance Dashboard - MongoDB Powered</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
/* ==================== Base Styles ==================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* ==================== Theme Variables ==================== */

/* Light Theme (Default) */
:root[data-theme="light"] {
  --primary: #6366f1; /* Elegant Indigo */
  --secondary: #8b5cf6; /* Vibrant Violet */
  --success: #0ea5e9; /* Ocean Blue */
  --warning: #f59e0b; /* Honey Amber */
  --danger: #dc2626; /* Scarlet Bloom */
  --info: #3b82f6; /* Sky Signal */
  --dark: #111827; /* Deep Charcoal */
  --light: #f9fafb; /* Mist White */
  --white: #ffffff;
  --border: #e5e7eb;
  --text-dark: #111827;
  --text-light: #6b7280;
  --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  --bg-main: linear-gradient(135deg, #f9fafb, #eef2ff);
  --card-bg: #ffffff;
  --navbar-bg: linear-gradient(135deg, #6366f1, #8b5cf6);
  --blur-amount: 0px;
  --card-opacity: 1;
}

:root[data-theme="dark"] {
  --primary: #818cf8; /* Electric Indigo */
  --secondary: #c084fc; /* Radiant Orchid */
  --success: #22d3ee; /* Neon Aqua */
  --warning: #facc15; /* Golden Ember */
  --danger: #fb7185; /* Coral Flame */
  --info: #60a5fa; /* Azure Edge */
  --dark: #0f172a; /* Midnight Abyss */
  --light: #1e293b; /* Deep Smoke */
  --white: #0b1120; /* Ink */
  --border: #334155;
  --text-dark: #f1f5f9;
  --text-light: #94a3b8;
  --shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
  --bg-main: linear-gradient(135deg, #0f172a, #1e293b);
  --card-bg: #1e293b;
  --navbar-bg: linear-gradient(135deg, #312e81, #1e3a8a);
  --blur-amount: 0px;
  --card-opacity: 1;
}

:root[data-theme="blur-light"] {
  --primary: #6366f1;
  --secondary: #8b5cf6;
  --success: #0ea5e9;
  --warning: #f59e0b;
  --danger: #dc2626;
  --info: #3b82f6;
  --dark: #111827;
  --light: rgba(249, 250, 251, 0.8);
  --white: rgba(255, 255, 255, 0.6);
  --border: rgba(229, 231, 235, 0.3);
  --text-dark: #111827;
  --text-light: #6b7280;
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  --bg-main: linear-gradient(135deg, #6366f120, #8b5cf620);
  --card-bg: rgba(255, 255, 255, 0.65);
  --navbar-bg: rgba(99, 102, 241, 0.8);
  --blur-amount: 15px;
  --card-opacity: 0.75;
}

:root[data-theme="blur-dark"] {
  --primary: #818cf8;
  --secondary: #c084fc;
  --success: #22d3ee;
  --warning: #facc15;
  --danger: #fb7185;
  --info: #60a5fa;
  --dark: #0f172a;
  --light: rgba(30, 41, 59, 0.6);
  --white: rgba(15, 23, 42, 0.7);
  --border: rgba(51, 65, 85, 0.3);
  --text-dark: #f1f5f9;
  --text-light: #94a3b8;
  --shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
  --bg-main: linear-gradient(135deg, #0f172a, #1e293b);
  --card-bg: rgba(30, 41, 59, 0.6);
  --navbar-bg: rgba(49, 46, 129, 0.8);
  --blur-amount: 15px;
  --card-opacity: 0.75;
}

/* ==================== Body & Container ==================== */

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-main);
    color: var(--text-dark);
    line-height: 1.6;
    transition: all 0.3s ease;
    min-height: 100vh;
}

[data-theme="blur-light"] body,
[data-theme="blur-dark"] body {
    backdrop-filter: blur(var(--blur-amount));
}

/* Smooth Theme Transition */
body.theme-transition {
  transition: background 0.4s ease, color 0.4s ease;
}

html {
  transition: background-color 0.4s ease, color 0.4s ease;
}


/* ==================== Navbar ==================== */

.navbar {
    background: var(--navbar-bg);
    color: white;
    padding: 1rem 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(var(--blur-amount));
}

.navbar-container {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.navbar-brand h1 {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
}

/* Mobile Menu Toggle (hidden on desktop) */
.mobile-menu-toggle {
    display: none;
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
    font-size: 1.5rem;
    transition: all 0.3s;
}

.mobile-menu-toggle:hover {
    background: rgba(255,255,255,0.3);
}

/* Navbar Menu */
.navbar-menu {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.connection-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    white-space: nowrap;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.user-info i {
    font-size: 1.25rem;
}

/* Theme Selector */
.theme-selector {
    position: relative;
    display: inline-block;
}

.theme-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
    white-space: nowrap;
}

.theme-btn:hover {
    background: rgba(255,255,255,0.3);
}

.theme-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    border-radius: 0.5rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    margin-top: 0.5rem;
    min-width: 200px;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.theme-dropdown.show {
    display: block;
}

.theme-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
    border-bottom: 1px solid var(--border);
}

.theme-option:last-child {
    border-bottom: none;
}

.theme-option:hover {
    background: var(--light);
}

.theme-option.active {
    background: var(--primary);
    color: white;
}

.navbar .user-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.connection-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-dot.connected { background: #10b981; }
.status-dot.disconnected { background: #ef4444; }

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Theme Selector Dropdown */
.theme-selector {
    position: relative;
    display: inline-block;
}

.theme-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
}

.theme-btn:hover {
    background: rgba(255,255,255,0.3);
}

.theme-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    border-radius: 0.5rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    margin-top: 0.5rem;
    min-width: 200px;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.theme-dropdown.show {
    display: block;
}

.theme-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
    border-bottom: 1px solid var(--border);
}

.theme-option:last-child {
    border-bottom: none;
}

.theme-option:hover {
    background: var(--light);
}

.theme-option.active {
    background: var(--primary);
    color: white;
}

/* ==================== Container ==================== */

.container {
    max-width: 1600px;
    margin: 1.5rem auto;
    padding: 0 1rem;
}

/* ==================== Stats Grid ==================== */

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1.25rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(var(--blur-amount));
    opacity: var(--card-opacity);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    color: white;
    flex-shrink: 0;
}

.stat-icon.primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
.stat-icon.success { background: linear-gradient(135deg, #10b981, #059669); }
.stat-icon.warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
.stat-icon.danger { background: linear-gradient(135deg, #ef4444, #dc2626); }
.stat-icon.info { background: linear-gradient(135deg, #3b82f6, #2563eb); }

.stat-content h3 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.stat-content p {
    color: var(--text-light);
    font-size: 0.875rem;
}

/* ==================== Section Cards ==================== */

.section-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
    backdrop-filter: blur(var(--blur-amount));
    opacity: var(--card-opacity);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
    flex-wrap: wrap;
    gap: 1rem;
}

.section-header h2 {
    font-size: 1.25rem;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* ==================== Buttons ==================== */

.btn {
    padding: 0.625rem 1.25rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.btn-danger {
    background: var(--danger);
    color: white;
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-warning {
    background: var(--warning);
    color: white;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* ==================== Charts ==================== */

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.chart-container {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 1rem;
    box-shadow: var(--shadow);
    backdrop-filter: blur(var(--blur-amount));
}

/* ==================== Tables ==================== */

.table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
}

thead {
    background: var(--light);
}

th, td {
    padding: 0.875rem;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

th {
    font-weight: 600;
    color: var(--text-dark);
    font-size: 0.875rem;
    text-transform: uppercase;
}

tbody tr {
    transition: background 0.2s;
}

tbody tr:hover {
    background: var(--light);
}

/* ==================== Badges ==================== */

.badge {
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
}

.badge-success { background: #d1fae5; color: #065f46; }
.badge-danger { background: #fee2e2; color: #991b1b; }
.badge-warning { background: #fef3c7; color: #92400e; }
.badge-info { background: #dbeafe; color: #1e40af; }

/* ==================== Tabs ==================== */

.tabs {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid var(--border);
    margin-bottom: 1.5rem;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.tab {
    padding: 0.75rem 1.25rem;
    border: none;
    background: none;
    cursor: pointer;
    font-weight: 600;
    color: var(--text-light);
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
    white-space: nowrap;
}

.tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.tab:hover {
    color: var(--primary);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* ==================== Modals ==================== */

.modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 1rem;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s;
    backdrop-filter: blur(var(--blur-amount));
}

@keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
}

.modal-header h3 {
    font-size: 1.5rem;
    color: var(--primary);
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-light);
}

.close-btn:hover {
    color: var(--danger);
}

/* ==================== Forms ==================== */

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-dark);
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--border);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: border-color 0.3s;
    background: var(--card-bg);
    color: var(--text-dark);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary);
}

/* ==================== Footer ==================== */

 .footer {
    background: linear-gradient(135deg, var(--dark) 0%, #0f172a 100%);
    color: white;
    padding: 3rem 2rem 1.5rem;
    margin-top: 4rem;
}

.footer-content {
    max-width: 1600px;
    margin: 0 auto;
}

.footer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 3rem;
    margin-bottom: 2rem;
}

.footer-section h3 {
    color: var(--primary);
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.footer-section p {
    color: #94a3b8;
    line-height: 1.8;
    margin-bottom: 1rem;
}

.team-members {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.team-member {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 0.5rem;
    transition: all 0.3s;
}

.team-member:hover {
    background: rgba(102, 126, 234, 0.1);
    transform: translateX(5px);
}

.member-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
}

.member-info h4 {
    color: white;
    margin-bottom: 0.25rem;
    font-size: 1rem;
}

.member-info p {
    color: #64748b;
    font-size: 0.875rem;
    margin: 0;
}

.quick-links {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.quick-links a {
    color: #94a3b8;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s;
}

.quick-links a:hover {
    color: var(--primary);
    transform: translateX(5px);
}

.social-links {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.social-link {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    text-decoration: none;
    transition: all 0.3s;
}

.social-link:hover {
    background: var(--primary);
    transform: translateY(-3px);
}

.footer-bottom {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.copyright {
    color: #64748b;
    font-size: 0.875rem;
}

.copyright a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
}

.copyright a:hover {
    text-decoration: underline;
}

.tech-stack {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.tech-badge {
    padding: 0.375rem 0.75rem;
    background: rgba(102, 126, 234, 0.1);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 0.375rem;
    color: var(--primary);
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

@media (max-width: 768px) {
    .footer {
        padding: 2rem 1rem 1rem;
    }
    
    .footer-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .footer-bottom {
        flex-direction: column;
        text-align: center;
    }
    
    .tech-stack {
        flex-wrap: wrap;
        justify-content: center;
    }
}
.action-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

/* ==================== Notifications ==================== */

.notification {
    position: fixed;
    top: 5rem;
    right: 1rem;
    background: var(--card-bg);
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    z-index: 9999;
    min-width: 280px;
    max-width: 90vw;
    animation: slideIn 0.3s ease-out;
    backdrop-filter: blur(10px);
}

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.notification.success { border-left: 4px solid var(--success); }
.notification.warning { border-left: 4px solid var(--warning); }
.notification.danger { border-left: 4px solid var(--danger); }

/* ==================== Responsive Design ==================== */

@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .navbar {
        padding: 0.875rem 1rem;
    }
    
    .navbar-brand h1 {
        font-size: 1.1rem;
    }
    
    .navbar-brand h1 a {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    /* Show hamburger menu */
    .mobile-menu-toggle {
        display: block;
        order: 3;
    }
    
    /* Hide menu by default */
    .navbar-menu {
        display: none;
        position: fixed;
        top: 56px;
        left: 0;
        right: 0;
        background: var(--navbar-bg);
        flex-direction: column;
        padding: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        backdrop-filter: blur(15px);
        max-height: calc(100vh - 56px);
        overflow-y: auto;
        gap: 0.75rem;
    }
    
    /* Show menu when active */
    .navbar-menu.active {
        display: flex;
        animation: slideDown 0.3s ease-out;
    }
    
    /* Full width elements in mobile menu */
    .navbar-menu > * {
        width: 100%;
    }
    
    .navbar-menu .btn {
        justify-content: center;
    }
    
    .navbar-menu .theme-selector {
        width: 100%;
    }
    
    .navbar-menu .theme-btn {
        width: 100%;
        justify-content: center;
    }
    
    .navbar-menu .connection-status,
    .navbar-menu .user-info {
        justify-content: center;
        padding: 0.75rem;
        background: rgba(255,255,255,0.1);
        border-radius: 0.5rem;
    }
    
    /* Theme dropdown full width on mobile */
    .theme-dropdown {
        position: relative;
        width: 100%;
        margin-top: 0.5rem;
        right: auto;
    }
    .navbar h1 {
        font-size: 1.25rem;
    }
    
    .navbar .user-section {
        width: 100%;
        justify-content: space-between;
    }
    
    .container {
        padding: 0 0.75rem;
        margin: 1rem auto;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-card {
        padding: 1.25rem;
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
    }
    
    .stat-content h3 {
        font-size: 1.5rem;
    }
    
    .section-card {
        padding: 1.25rem;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    th, td {
        padding: 0.5rem;
        font-size: 0.75rem;
    }
    
    .footer {
        padding: 2rem 1rem 1rem;
    }
    
    .footer-grid {
        grid-template-columns: 1fr;
    }
    
    .notification {
        min-width: auto;
        right: 0.5rem;
        left: 0.5rem;
    }
}

@media (max-width: 480px) {
    .navbar {
        padding: 0.75rem 0.875rem;
    }
    
    .navbar-brand h1 {
        font-size: 1rem;
    }
    
    .navbar-brand h1 i {
        font-size: 0.875rem;
    }
    
    .mobile-menu-toggle {
        font-size: 1.25rem;
        padding: 0.4rem 0.6rem;
    }
    
    .btn {
        font-size: 0.875rem;
        padding: 0.625rem 1rem;
    }
    
    .btn-text {
        display: inline;
    }
}
    
    .tabs {
        gap: 0.25rem;
    }
    
    .tab {
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
    }

</style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
    <div class="navbar-container">
        <!-- Brand -->
        <div class="navbar-brand">
            <h1>
                <a href="/info" style="color: white; text-decoration: none;">
                    <i class="fas fa-chart-line"></i> Attendance Dashboard
                </a>
            </h1>
        </div>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- User Section (collapsible on mobile) -->
        <div class="navbar-menu" id="navbarMenu">
            <div class="connection-status">
                <span class="status-dot connected" id="statusDot"></span>
                <span id="statusText">Connected</span>
            </div>
            
            <!-- Theme Selector -->
            <div class="theme-selector">
                <button class="theme-btn" onclick="toggleThemeDropdown()">
                    <i class="fas fa-sun" id="themeIcon"></i>
                    <span>Theme</span>
                </button>
                <div class="theme-dropdown" id="themeDropdown">
                    <div class="theme-option active" data-theme-value="light" onclick="setTheme('light')">
                        <i class="fas fa-sun"></i>
                        <span>Light</span>
                    </div>
                    <div class="theme-option" data-theme-value="dark" onclick="setTheme('dark')">
                        <i class="fas fa-moon"></i>
                        <span>Dark</span>
                    </div>
                    <div class="theme-option" data-theme-value="blur-light" onclick="setTheme('blur-light')">
                        <i class="fas fa-cloud-sun"></i>
                        <span>Blur Light</span>
                    </div>
                    <div class="theme-option" data-theme-value="blur-dark" onclick="setTheme('blur-dark')">
                        <i class="fas fa-cloud-moon"></i>
                        <span>Blur Dark</span>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-warning" onclick="openPasswordModal()">
                <i class="fas fa-key"></i> 
                <span class="btn-text">Change Password</span>
            </button>
            
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <strong>{{ session.get('username') }}</strong>
            </div>
            
            <a href="{{ url_for('logout') }}" class="btn btn-danger">
                <i class="fas fa-sign-out-alt"></i> 
                <span class="btn-text">Logout</span>
            </a>
        </div>
    </div>
</nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Statistics Cards (same as before) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary"><i class="fas fa-users"></i></div>
                <div class="stat-content">
                    <h3 id="totalStudents">-</h3>
                    <p>Total Students</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon success"><i class="fas fa-user-check"></i></div>
                <div class="stat-content">
                    <h3 id="presentStudents">-</h3>
                    <p>Present Today</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon warning"><i class="fas fa-clock"></i></div>
                <div class="stat-content">
                    <h3 id="lateArrivals">-</h3>
                    <p>Late Arrivals</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon danger"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-content">
                    <h3 id="unknownCards">-</h3>
                    <p>Unknown Cards</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon info"><i class="fas fa-percentage"></i></div>
                <div class="stat-content">
                    <h3 id="attendanceRate">-</h3>
                    <p>Attendance Rate</p>
                </div>
            </div>
        </div>

        <!-- API Key Section (same as before) -->
        <div class="section-card">
            <div class="section-header">
                <h2><i class="fas fa-key"></i> Arduino API Key</h2>
                <button class="btn btn-danger" onclick="regenerateApiKey()">
                    <i class="fas fa-sync-alt"></i> Regenerate Key
                </button>
            </div>
            <div class="api-key-box">
                <p style="margin-bottom: 1rem; color: var(--text-light);">
                    <i class="fas fa-info-circle"></i> Use this API key in your Arduino code
                </p>
                <div class="api-key-display" id="apiKeyDisplay">Loading...</div>
            </div>
        </div>

        <!-- Charts (same as before) -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">
                    <i class="fas fa-chart-line"></i> Weekly Attendance Trend
                </h3>
                <canvas id="weeklyChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">
                    <i class="fas fa-chart-pie"></i> Today's Status
                </h3>
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- Tabs Section with Students Management -->
        <div class="section-card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('recent')">
                    <i class="fas fa-history"></i> Recent Activity
                </button>
                <button class="tab" onclick="switchTab('students')">
                    <i class="fas fa-users"></i> Manage Students
                </button>
                <button class="tab" onclick="switchTab('unknown')">
                    <i class="fas fa-question-circle"></i> Unknown Cards
                </button>
                <button class="tab" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>

            <!-- Recent Activity Tab -->
            <div id="recent" class="tab-content active">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Student Name</th>
                                <th>Class</th>
                                <th>Action</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentLogsBody">
                            <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Students Management Tab -->
            <div id="students" class="tab-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Reg No</th>
                                <th>RFID UID</th>
                                <th>Parent Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsBody">
                            <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Unknown Cards Tab -->
            <div id="unknown" class="tab-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>RFID UID</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="unknownCardsBody">
                            <tr><td colspan="4" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Change Password</h3>
                <button class="close-btn" onclick="closePasswordModal()"><i class="fas fa-times"></i></button>
            </div>
            <form id="passwordForm" onsubmit="changePassword(event)">
                <div class="form-group">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" minlength="6" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" minlength="6" required>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-check"></i> Update Password
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closePasswordModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Edit Student</h3>
                <button class="close-btn" onclick="closeEditModal()"><i class="fas fa-times"></i></button>
            </div>
            <form id="editStudentForm" onsubmit="updateStudent(event)">
                <input type="hidden" id="editStudentId">
                <div class="form-group">
                    <label for="editName">Student Name</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editClass">Class</label>
                    <input type="text" id="editClass" required>
                </div>
                <div class="form-group">
                    <label for="editRegNo">Registration Number</label>
                    <input type="text" id="editRegNo" required>
                </div>
                <div class="form-group">
                    <label for="editRfidUid">RFID UID</label>
                    <input type="text" id="editRfidUid" required>
                </div>
                <div class="form-group">
                    <label for="editParentEmail">Parent Email</label>
                    <input type="email" id="editParentEmail" required>
                </div>
                <div class="form-group">
                    <label for="editParentPhone">Parent Phone</label>
                    <input type="tel" id="editParentPhone">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- Register Student Modal -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-user-plus"></i> Register Student from Unknown Card</h3>
            <button class="close-btn" onclick="closeRegisterModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="registerForm" onsubmit="registerFromUnknown(event)">
            <input type="hidden" id="regUnknownId">
            
            <div class="form-group">
                <label>RFID UID (from scanned card)</label>
                <input type="text" id="regRfidUid" readonly style="background: var(--light);">
            </div>
            
            <div class="form-group">
                <label>Registration Number</label>
                <input type="text" id="regRegNo" required placeholder="e.g., 2025001">
            </div>
            
            <div class="form-group">
                <label>Student Name</label>
                <input type="text" id="regName" required placeholder="Full name">
            </div>
            
            <div class="form-group">
                <label>Class</label>
                <input type="text" id="regClass" required placeholder="e.g., 10-A">
            </div>
            
            <div class="form-group">
                <label>Parent Email</label>
                <input type="email" id="regParentEmail" required placeholder="parent@email.com">
            </div>
            
            <div class="form-group">
                <label>Parent Phone (Optional)</label>
                <input type="tel" id="regParentPhone" placeholder="+91 XXXXXXXXXX">
            </div>
            
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button type="submit" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-save"></i> Register Student
                </button>
                <button type="button" class="btn btn-danger" onclick="closeRegisterModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<div id="settings" class="tab-content">
    <div class="section-card">
        <div class="section-header">
            <h2><i class="fas fa-school"></i> School Settings</h2>
            <button class="btn btn-primary" onclick="saveSchoolSettings()">
                <i class="fas fa-save"></i> Save Settings
            </button>
        </div>
        
        <form id="settingsForm">
            <div class="form-group">
                <label>School Start Time</label>
                <input type="time" id="schoolStartTime" step="1" value="09:00:00" required>
            </div>
            
            <div class="form-group">
                <label>Late Threshold (minutes after start time)</label>
                <input type="number" id="lateThreshold" min="0" max="60" required>
            </div>
            
            <h3 style="margin-top: 2rem; color: var(--primary);">
                <i class="fas fa-envelope"></i> Email Notifications
            </h3>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="emailEnabled" style="width: auto;">
                <label style="margin: 0;">Enable Email Notifications</label>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="lateArrivalEmail" style="width: auto;">
                <label style="margin: 0;">Send Late Arrival Alerts</label>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="monthlyReportEmail" style="width: auto;">
                <label style="margin: 0;">Send Monthly Reports</label>
            </div>
            
            <div class="form-group">
                <label>Monthly Report Send Day (1-31)</label>
                <input type="number" id="monthlyReportDay" min="1" max="31" required>
            </div>
            
            <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="absenceAlertEmail" style="width: auto;">
                <label style="margin: 0;">Send Consecutive Absence Alerts</label>
            </div>
            
            <div class="form-group">
                <label>Alert After (consecutive days absent)</label>
                <input type="number" id="absenceAlertDays" min="1" max="10" required>
            </div>
            
            <div class="form-group">
                <label>Test Email Address</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="email" id="testEmail" placeholder="test@example.com" style="flex: 1;">
                    <button type="button" class="btn btn-primary" onclick="sendTestEmail()">
                        <i class="fas fa-paper-plane"></i> Send Test
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

        <!-- Footer -->
     <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <!-- About Section -->
                <div class="footer-section">
                    <h3><i class="fas fa-graduation-cap"></i> About Project</h3>
                    <p>
                        Enhanced RFID-based Attendance Management System using Arduino UNO R4 WiFi, 
                        MongoDB, and real-time WebSocket technology. Built for modern educational institutions.
                    </p>
                    <div class="social-links">
                        <a href="https://github.com/shreyansh0727" class="social-link" target="_blank" title="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="mailto:shreyanshm90051@gmail.com" class="social-link" title="Email">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>

                <!-- Team Members Section -->
                <div class="footer-section">
                    <h3><i class="fas fa-users"></i> Development Team</h3>
                    <div class="team-members">
                        <div class="team-member">
                            <div class="member-avatar">S</div>
                            <div class="member-info">
                                <h4>Shreyansh Kumar</h4>
                                <p>Full-Stack Developer & Project Lead</p>
                            </div>
                        </div>
                        <div class="team-member">
                            <div class="member-avatar">P</div>
                            <div class="member-info">
                                <h4>Prakhyat Kumar</h4>
                                <p>Logic & Cores</p>
                            </div>
                        </div>
                        <div class="team-member">
                            <div class="member-avatar">A</div>
                            <div class="member-info">
                                <h4>Avinesh Maurya</h4>
                                <p>Production Manager</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Links Section -->
                <div class="footer-section">
                    <h3><i class="fas fa-link"></i> Quick Links</h3>
                    <div class="quick-links">
                        <a href="https://shreyansh.hyperflowai.site" target="_blank">
                            <i class="fas fa-briefcase"></i> Portfolio Website
                        </a>
                        <a href="https://github.com/shreyansh0727/presentlogger" target="_blank">
                            <i class="fab fa-github"></i> GitHub Repository
                        </a>
                        <a href="https://docs.mongodb.com/" target="_blank">
                            <i class="fas fa-database"></i> MongoDB Documentation
                        </a>
                        <a href="https://docs.arduino.cc/" target="_blank">
                            <i class="fas fa-microchip"></i> Arduino Documentation
                        </a>
                        <a href="https://flask.palletsprojects.com/" target="_blank">
                            <i class="fas fa-flask"></i> Flask Documentation
                        </a>
                        <a href="https://www.sunbeamrobertsganj.com/" target="_blank">
                            <i class="fas fa-briefcase"></i> Our School
                        </a>
                    </div>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <div class="copyright">
                    <p>
                        &copy; 2025 <a href="https://shreyansh.hyperflowai.site" target="_blank">Shreyansh</a> | 
                        RFID Attendance System | 
                        Made with <i class="fas fa-heart" style="color: #ef4444;"></i> for Education
                    </p>
                </div>
                <div class="tech-stack">
                    <span class="tech-badge">
                        <i class="fas fa-microchip"></i> Arduino R4 WiFi
                    </span>
                    <span class="tech-badge">
                        <i class="fas fa-database"></i> MongoDB
                    </span>
                    <span class="tech-badge">
                        <i class="fab fa-python"></i> Flask
                    </span>
                    <span class="tech-badge">
                        <i class="fas fa-bolt"></i> Socket.IO
                    </span>
                </div>
            </div>
        </div>
    </footer>

  

    <script>
        // Socket.IO connection
        const socket = io({
            transports: ['polling', 'websocket'],
            reconnection: true
        });

        let weeklyChart, statusChart;

        socket.on('connect', () => {
            document.getElementById('statusDot').className = 'status-dot connected';
            document.getElementById('statusText').textContent = 'Connected';
            showNotification('Connected to real-time updates', 'success');
        });

        socket.on('disconnect', () => {
            document.getElementById('statusDot').className = 'status-dot disconnected';
            document.getElementById('statusText').textContent = 'Disconnected';
        });

        socket.on('attendance_update', (data) => {
            showNotification(`${data.student_name} - ${data.action}`, data.is_late ? 'warning' : 'success');
            fetchAllData();
        });

        // Fetch all data
        async function fetchAllData() {
            await Promise.all([
                fetchSystemStats(),
                fetchWeeklyTrend(),
                fetchRecentLogs(),
                fetchAllStudents(),
                fetchUnknownCards(),
                fetchApiKey()
            ]);
        }

        // Fetch system stats
        async function fetchSystemStats() {
            const response = await fetch('/api/system/stats');
            const data = await response.json();
            if (data.success) {
                document.getElementById('totalStudents').textContent = data.today.total_students;
                document.getElementById('presentStudents').textContent = data.today.present;
                document.getElementById('lateArrivals').textContent = data.today.late_arrivals;
                document.getElementById('unknownCards').textContent = data.alerts.unknown_cards;
                document.getElementById('attendanceRate').textContent = data.today.attendance_rate + '%';
                updateStatusChart(data.today);
            }
        }

        // Fetch weekly trend
        async function fetchWeeklyTrend() {
            const response = await fetch('/api/analytics/weekly-trend');
            const data = await response.json();
            if (data.success) {
                updateWeeklyChart(data.labels, data.attendance_rates);
            }
        }

        // Fetch recent logs
        // Option B: Prefer real "recent activity" using recent_logs from API
async function fetchRecentLogs() {
  const response = await fetch('/api/reports/daily');
  const data = await response.json();
  if (data.success) {
    const tbody = document.getElementById('recentLogsBody');
    tbody.innerHTML = '';
    data.recent_logs.forEach(log => {
      const badgeClass = log.action === 'EXIT' ? 'badge-danger' : 'badge-success';
      tbody.innerHTML += `
        <tr>
          <td>${log.timestamp}</td>
          <td>${log.name}</td>
          <td>${log.class_name || '-'}</td>
          <td><span class="badge ${badgeClass}">${log.action}</span></td>
          <td>${log.is_late ? 
            '<span class="badge badge-warning">Late</span>' : 
            '<span class="badge badge-success">On Time</span>'}</td>
        </tr>
      `;
    });
  }
}


        // Fetch all students
        async function fetchAllStudents() {
            const response = await fetch('/api/students');
            const data = await response.json();
            if (data.success) {
                const tbody = document.getElementById('studentsBody');
                tbody.innerHTML = '';
                data.students.forEach(student => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${student.name}</td>
                            <td>${student.class_name}</td>
                            <td>${student.reg_no}</td>
                            <td><code>${student.rfid_uid}</code></td>
                            <td>${student.parent_email}</td>
                            <td>${student.is_present ? 
                                '<span class="badge badge-success">Present</span>' : 
                                '<span class="badge badge-danger">Absent</span>'}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-primary btn-sm" onclick="openEditModal('${student.id}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.id}', '${student.name}')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        // Fetch unknown cards
        // Fetch unknown cards with Register + Delete buttons
async function fetchUnknownCards() {
    try {
        const response = await fetch('/api/unknown-cards');
        const data = await response.json();
        if (data.success) {
            const tbody = document.getElementById('unknownCardsBody');
            tbody.innerHTML = '';
            
            if (data.cards.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-light);">No unknown cards</td></tr>';
                return;
            }
            
            data.cards.forEach(card => {
                tbody.innerHTML += `
                    <tr>
                        <td><code style="font-size: 0.75rem;">${card.rfid_uid}</code></td>
                        <td>${card.date}</td>
                        <td>${card.timestamp}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-sm" onclick="openRegisterModal('${card.id}', '${card.rfid_uid}')">
                                    <i class="fas fa-user-plus"></i> Register
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteUnknownCard('${card.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }
    } catch (error) {
        console.error('Error fetching unknown cards:', error);
    }
}

// Open register modal
function openRegisterModal(unknownId, rfidUid) {
    document.getElementById('regUnknownId').value = unknownId;
    document.getElementById('regRfidUid').value = rfidUid;
    document.getElementById('registerModal').classList.add('active');
}

// Close register modal
function closeRegisterModal() {
    document.getElementById('registerModal').classList.remove('active');
    document.getElementById('registerForm').reset();
}

// Submit registration form
async function registerFromUnknown(event) {
    event.preventDefault();
    
    const unknownId = document.getElementById('regUnknownId').value;
    const payload = {
        reg_no: document.getElementById('regRegNo').value.trim(),
        name: document.getElementById('regName').value.trim(),
        class_name: document.getElementById('regClass').value.trim(),
        parent_email: document.getElementById('regParentEmail').value.trim(),
        parent_phone: document.getElementById('regParentPhone').value.trim()
    };
    
    try {
        const response = await fetch(`/api/unknown-cards/${unknownId}/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Student registered successfully!', 'success');
            closeRegisterModal();
            
            // Refresh all lists
            fetchUnknownCards();
            fetchAllStudents();
            fetchSystemStats();
        } else {
            showNotification(data.error || 'Registration failed', 'danger');
        }
    } catch (error) {
        showNotification('Network error. Please try again.', 'danger');
    }
}

// Delete unknown card
async function deleteUnknownCard(cardId) {
    if (!confirm('Delete this unknown card?')) return;
    
    try {
        const response = await fetch(`/api/unknown-cards/${cardId}`, {
            method: 'DELETE'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Unknown card deleted', 'success');
            fetchUnknownCards();
            fetchSystemStats();
        } else {
            showNotification(data.error || 'Delete failed', 'danger');
        }
    } catch (error) {
        showNotification('Network error', 'danger');
    }
}


        // Fetch API key
        async function fetchApiKey() {
            const response = await fetch('/api/system/current-api-key');
            const data = await response.json();
            if (data.success && data.has_key) {
                document.getElementById('apiKeyDisplay').textContent = data.api_key_info.key_preview;
            }
        }

        // Password change functions
        function openPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('passwordForm').reset();
        }

        async function changePassword(event) {
            event.preventDefault();
            
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (newPass !== confirm) {
                showNotification('New passwords do not match', 'danger');
                return;
            }

            const response = await fetch('/api/admin/change-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    current_password: current,
                    new_password: newPass,
                    confirm_password: confirm
                })
            });

            const data = await response.json();
            if (data.success) {
                showNotification('Password changed successfully', 'success');
                closePasswordModal();
            } else {
                showNotification(data.error, 'danger');
            }
        }

        // Student edit functions
        async function openEditModal(studentId) {
            const response = await fetch(`/api/students/${studentId}/edit`);
            const data = await response.json();
            
            if (data.success) {
                const student = data.student;
                document.getElementById('editStudentId').value = student.id;
                document.getElementById('editName').value = student.name;
                document.getElementById('editClass').value = student.class_name;
                document.getElementById('editRegNo').value = student.reg_no;
                document.getElementById('editRfidUid').value = student.rfid_uid;
                document.getElementById('editParentEmail').value = student.parent_email;
                document.getElementById('editParentPhone').value = student.parent_phone || '';
                
                document.getElementById('editStudentModal').classList.add('active');
            }
        }

        function closeEditModal() {
            document.getElementById('editStudentModal').classList.remove('active');
        }

        async function updateStudent(event) {
            event.preventDefault();
            
            const studentId = document.getElementById('editStudentId').value;
            const data = {
                name: document.getElementById('editName').value,
                class_name: document.getElementById('editClass').value,
                reg_no: document.getElementById('editRegNo').value,
                rfid_uid: document.getElementById('editRfidUid').value,
                parent_email: document.getElementById('editParentEmail').value,
                parent_phone: document.getElementById('editParentPhone').value
            };

            const response = await fetch(`/api/students/${studentId}/edit`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (result.success) {
                showNotification('Student updated successfully', 'success');
                closeEditModal();
                fetchAllStudents();
            } else {
                showNotification(result.error, 'danger');
            }
        }

        async function deleteStudent(studentId, studentName) {
            if (!confirm(`Are you sure you want to delete ${studentName}?`)) return;

            const response = await fetch(`/api/students/${studentId}`, { method: 'DELETE' });
            const data = await response.json();

            if (data.success) {
                showNotification('Student deleted successfully', 'success');
                fetchAllStudents();
                fetchSystemStats();
            } else {
                showNotification(data.error, 'danger');
            }
        }

        async function deleteUnknownCard(cardId) {
            const response = await fetch(`/api/unknown-cards/${cardId}`, { method: 'DELETE' });
            const data = await response.json();
            if (data.success) {
                showNotification('Unknown card removed', 'success');
                fetchUnknownCards();
            }
        }

        async function regenerateApiKey() {
            if (!confirm('This will invalidate the current API key. Continue?')) return;

            const response = await fetch('/api/system/regenerate-api-key', { method: 'POST' });
            const data = await response.json();

            if (data.success) {
                alert(`New API Key:\n\n${data.api_key_info.full_key}\n\nCopy this now!`);
                navigator.clipboard.writeText(data.api_key_info.full_key);
                showNotification('API key copied to clipboard', 'success');
                fetchApiKey();
            }
        }

        // Charts
        function updateWeeklyChart(labels, data) {
            const ctx = document.getElementById('weeklyChart');
            if (weeklyChart) weeklyChart.destroy();
            weeklyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Attendance Rate (%)',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        function updateStatusChart(data) {
            const ctx = document.getElementById('statusChart');
            if (statusChart) statusChart.destroy();
            statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Present', 'Absent', 'Late'],
                    datasets: [{
                        data: [data.present, data.absent, data.late_arrivals],
                        backgroundColor: ['#10b981', '#ef4444', '#f59e0b']
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i> ${message}`;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        // Load school settings
async function loadSchoolSettings() {
    try {
        const response = await fetch('/api/settings/school');
        const data = await response.json();
        
        if (data.success) {
            const s = data.settings;
            document.getElementById('schoolStartTime').value = s.school_start_time || '09:00:00';
            document.getElementById('lateThreshold').value = s.late_threshold_minutes || 15;
            document.getElementById('emailEnabled').checked = s.email_notifications_enabled || false;
            document.getElementById('lateArrivalEmail').checked = s.late_arrival_email || false;
            document.getElementById('monthlyReportEmail').checked = s.monthly_report_email || false;
            document.getElementById('monthlyReportDay').value = s.monthly_report_day || 1;
            document.getElementById('absenceAlertEmail').checked = s.absence_alert_email || false;
            document.getElementById('absenceAlertDays').value = s.absence_alert_days || 3;
        }
    } catch (error) {
        console.error('Error loading settings:', error);
    }
}

// Save school settings
async function saveSchoolSettings() {
    const settings = {
        school_start_time: document.getElementById('schoolStartTime').value,
        late_threshold_minutes: parseInt(document.getElementById('lateThreshold').value),
        email_notifications_enabled: document.getElementById('emailEnabled').checked,
        late_arrival_email: document.getElementById('lateArrivalEmail').checked,
        monthly_report_email: document.getElementById('monthlyReportEmail').checked,
        monthly_report_day: parseInt(document.getElementById('monthlyReportDay').value),
        absence_alert_email: document.getElementById('absenceAlertEmail').checked,
        absence_alert_days: parseInt(document.getElementById('absenceAlertDays').value)
    };
    
    try {
        const response = await fetch('/api/settings/school', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Settings saved successfully', 'success');
        } else {
            showNotification(data.error || 'Save failed', 'danger');
        }
    } catch (error) {
        showNotification('Network error', 'danger');
    }
}

// Send test email
async function sendTestEmail() {
    const email = document.getElementById('testEmail').value;
    
    if (!email) {
        showNotification('Please enter an email address', 'warning');
        return;
    }
    
    try {
        const response = await fetch('/api/notifications/test-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Test email sent! Check your inbox.', 'success');
        } else {
            showNotification(data.error || 'Failed to send email', 'danger');
        }
    } catch (error) {
        showNotification('Network error', 'danger');
    }
}

// Load settings on page load
        fetchAllData();
        loadSchoolSettings();


        // Initial load
        fetchAllData();
        setInterval(fetchAllData, 30000);
    </script>

  <script>
// Mobile Menu Toggle
function toggleMobileMenu() {
    const menu = document.getElementById('navbarMenu');
    const toggleBtn = document.querySelector('.mobile-menu-toggle i');
    menu.classList.toggle('active');
    toggleBtn.className = menu.classList.contains('active') ? 'fas fa-times' : 'fas fa-bars';
}

// Close menu when clicking outside
document.addEventListener('click', function(event) {
    const navbar = document.querySelector('.navbar-container');
    const menu = document.getElementById('navbarMenu');
    if (menu && !navbar.contains(event.target) && window.innerWidth <= 768) {
        menu.classList.remove('active');
        const toggleBtn = document.querySelector('.mobile-menu-toggle i');
        if (toggleBtn) toggleBtn.className = 'fas fa-bars';
    }
});

// Close menu on window resize
window.addEventListener('resize', function() {
    const menu = document.getElementById('navbarMenu');
    if (window.innerWidth > 768 && menu && menu.classList.contains('active')) {
        menu.classList.remove('active');
        const toggleBtn = document.querySelector('.mobile-menu-toggle i');
        if (toggleBtn) toggleBtn.className = 'fas fa-bars';
    }
});

//  Theme Management
function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeUI(savedTheme);
}

// Toggle dropdown
function toggleThemeDropdown() {
    const dropdown = document.getElementById('themeDropdown');
    dropdown.classList.toggle('show');
}

//  Smooth Theme Transition
function setTheme(theme) {
    const body = document.body;

    // Add transition overlay
    body.classList.add('theme-transition');
    document.documentElement.style.transition = 'filter 0.4s ease, background 0.4s ease, color 0.4s ease';
    document.documentElement.style.filter = 'blur(10px) brightness(1.1)';

    // Wait for blur animation
    setTimeout(() => {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        updateThemeUI(theme);
    }, 200);

    // Smoothly remove blur
    setTimeout(() => {
        document.documentElement.style.filter = 'blur(0px) brightness(1)';
    }, 400);

    // End transition class after fade
    setTimeout(() => {
        body.classList.remove('theme-transition');
        document.documentElement.style.transition = '';
    }, 700);

    toggleThemeDropdown();
}

// Update theme icons and active states
function updateThemeUI(theme) {
    document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.remove('active');
    });
    const activeOption = document.querySelector(`[data-theme-value="${theme}"]`);
    if (activeOption) activeOption.classList.add('active');

    const icons = {
        'light': 'fa-sun',
        'dark': 'fa-moon',
        'blur-light': 'fa-cloud-sun',
        'blur-dark': 'fa-cloud-moon'
    };
    
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) themeIcon.className = `fas ${icons[theme] || 'fa-sun'}`;
}

// Close theme dropdown when clicking outside
document.addEventListener('click', function(event) {
    const themeSelector = document.querySelector('.theme-selector');
    const themeDropdown = document.getElementById('themeDropdown');
    if (themeSelector && !themeSelector.contains(event.target) && themeDropdown) {
        themeDropdown.classList.remove('show');
    }
});

// Initialize
window.addEventListener('DOMContentLoaded', initTheme);
</script>


</body>
</html>




